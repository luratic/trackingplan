___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "displayName": "Trackingplan",
  "categories": [
    "ANALYTICS",
    "HEAT_MAP",
    "SESSION_RECORDING"
  ],
  "description": "This is an unofficial Google Tag Manager template for Trackingplan.",
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "displayName": "Luratic",
    "id": "github.com_luratic",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "simpleValueType": true,
    "name": "id",
    "type": "TEXT",
    "valueValidators": [
      {
        "type": "NON_EMPTY",
        "enablingConditions": []
      },
      {
        "type": "REGEX",
        "args": [
          "TP.+"
        ]
      }
    ],
    "displayName": "Trackingplan ID",
    "valueHint": "TP123456",
    "alwaysInSummary": true
  },
  {
    "type": "GROUP",
    "name": "advanced_options",
    "displayName": "Advanced Options",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "environment",
        "displayName": "Environment",
        "simpleValueType": true,
        "defaultValue": "PRODUCTION",
        "alwaysInSummary": false
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "info",
    "displayName": "Information",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "LABEL",
        "name": "info_web",
        "displayName": "\u003cstrong\u003e\u003ca href\u003d\"https://docs.trackingplan.com/\"\u003eTrackingplan documentation\u003c/a\u003e\u003c/strong\u003e"
      },
      {
        "type": "LABEL",
        "name": "community",
        "displayName": "\u003cstrong\u003e\u003ca href\u003d\"https://datola.es?utm_source\u003dgtm\u0026utm_medium\u003dtemplates\u0026utm_campaign\u003dtrackingplan\"\u003eDatola - Community 📊\u003c/a\u003e\u003c/strong\u003e"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const callInWindow = require('callInWindow');


const log = require('logToConsole');
log("data", data);
const id = data.id;
const environment = data.environment;

const consent = data.consent; 
const trackingUrl = 'https://cdn.jsdelivr.net/gh/trackingplan/trackingplan.js/trackingplan.min.js';

const onSuccess = () => {
  callInWindow('Trackingplan.init', id, {
    environment: environment
  });
};

injectScript(trackingUrl, onSuccess, data.gtmOnFailure, 'tp');


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.jsdelivr.net/gh/trackingplan/trackingplan.js/trackingplan.min.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "Trackingplan"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "Trackingplan.init"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: gtmOnSuccess is invoked on injectScript success
  code: |-
    // test that gtmOnSuccess() is called when injectScript succeeds
    mock('injectScript', (url, onSuccess, onFailure) => {
      onSuccess();
    });

    // Call runCode to run the template's code.
    runCode();

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: gtmOnFailure is invoked when injectScript fails
  code: |-
    // test gtmOnFailure() is called when injectScript fails
    mock('injectScript', (url, onSuccess, onFailure) => {
      onFailure();
    });

    // Call runCode to run the template's code.
    runCode();

    // Verify onFailure was called
    assertApi('gtmOnFailure').wasCalled();


___NOTES___

Developed with ❤ by: Alfonso, Txema and Brais.
Web: www.luratic.com
RRSS: 
https://www.linkedin.com/in/braiscalvo/ | https://twitter.com/braiscv
https://www.linkedin.com/in/alfonsorc/
https://www.linkedin.com/in/txemasm/


